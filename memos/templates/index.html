<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> <head>
<title>Memos</title>

  <!-- 'viewport' is used by bootstrap to respond to device size -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Javascript:  JQuery from a content distribution network (CDN) -->
  <script
     src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
  </script>

  <!-- Bootstrap includes javascript and css  (must follow jquery) -->
  <link rel="stylesheet"
   href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
   <script
    src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js">
</script>

   <!-- Our own style sheet -->
   <link rel="stylesheet" href="/static/css/memos.css" />


</head>
<body>
<div class="container">

<h3>Make a new memo:</h3>
<input type="text" name = "memo" id = "memo" value = "memo"> 
<input type="date" name = "date" id = "date" value = "mm/dd/yy"> 
<input type="button" name = "submit_memo" id = "submit_memo" value = "save memo">

<div id = "memo_list" />

<script>

  $(document).ready(function(){

    // retrieve + draw current memos on
    // page load.
    $.ajax({
      type : "GET",
      url : "_retrieve_memos",
      success : function(res){
        drawMemos(res);
        console.log("called retrieve memos")
      }
    });

    // call postMemo with contents of the
    // fields above when the submit button
    // is clicked
    $("#submit_memo").click(function(e){
      e.preventDefault();
      postMemo({
        "memo" : $("#memo").val(),
        "date" : $("#date").val()
      });
    });
  });

  // inserts the passed memo into the database
  // the query will asynchronously update the 
  // memos within the document upon insertion.
  function postMemo(memo){
    return $.ajax({
     type : "POST",
     url  : "_create_memo",
     data : memo,

     // update memos in view
     success : function(res){
      drawMemos(res);
     }
    });
  }

  // Draws returned memos from AJAX query, synchronizing
  // the client's view with the database
  function drawMemos(res){

    // renders the memo list as formatted HTML using the
    // MEMOTEMPLATE ECMAS5 template.then unifies the individual HTML elements
    $("#memo_list").html(

      // maps JSON response to MEMOTEMPLATE, then joins
      // array elements into a single HTML string.
      res.map((text, date, id) => {
        return MEMOTEMPLATE(text, date, id);
      }).join('')
    );
  }

  // template for rendering memos in the view.
  const MEMOTEMPLATE = ({text, date, id}) => {
    return `
        <div class = "list-group-item memo">
          <p class = "memo-date">${date}</p>
          <h3 class = "memo-text">${text}</h3>
        </div>
      `
    };
 
</script>

</div> <!-- container -->
</body>
</html>
